{% extends 'layout.html.twig' %}
{% set homepage = true %}
{% block body %}
<div class="container" id="container_fiche" style="display:none;">
</div>
<div class="container" id="container_find">

	{{ form_start(form) }}
	{{ form_widget(form.myfind) }}
	{{ form_end(form) }}
	<br/>
  <div class="list-group" id="results">
  </div>
</div>
{% endblock %}
{% block script %}
<script>

$(document).ready(function(){
	$('#form_myfind').keyup(function() {
	  var value = $(this).val();
	  	if(value === '' || value.length < 3) {
	  		$('#results').empty();
  		}
  		else {
	      $.ajax({
	         url : '{{ path('search') }}', 
	         type : 'GET', 
	         data : 'search=' + value,
	         success: function(reponse) { 
	     		$('#results').empty();
	     	    if (reponse.error) {
     	    		$('#results').prepend('<p>{{ 'core.find.msg.nofind'|trans }}</p>');
	     	    }
	     	    else {
					Object.keys(reponse).forEach(function(key) {
					    $('#results').prepend('<a href="'+ reponse[key].link +'" class="list-group-item theFind">'+ reponse[key].name +'</a>');
					});
	     	    }
	          },
             error: function() { 
                $('#results').empty();
                $('#results').html('<p>{{ 'core.find.msg.error'|trans }}</p>');
                }
	      });
  		}
	});

});

$("#results").on("click", "a.theFind", function(){
	var href = $(this).attr('href');
    $('#container_find').hide('slow');
    $('#container_fiche').load(href);
    $('#container_fiche').show('slow');
    return false;
});
</script>
{% endblock %}